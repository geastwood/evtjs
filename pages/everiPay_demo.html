<html>
    <head>
        <title>everiPay</title>
        <meta name="viewport" content="width=device-width,target-densitydpi=high-dpi,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <style>
            body {
                margin: 1.5rem;
                background-color: #3d226d;
                color: white;
                font-size: 90%;
            }
            pre, pre * {
                white-space:pre-wrap;
                white-space:-moz-pre-wrap;
                white-space:-pre-wrap;
                white-space:-o-pre-wrap;
                word-wrap:break-word;
                font-family: "Source Code Pro", 'Courier New', Courier, monospace;
            }
            button {
                background-color:blueviolet;
                color: white;
                font-size: 1.1rem;
                border: none;
                outline: none;
                padding: .5rem;
            }
            .scanzone-wraper  {
                background-color: white;
                border-radius: 8px;
            }
            p, h1, h2, h3 {
                margin: 0;
                padding: 0;
                color: rgb(240, 240, 240);
            }
        </style>
    </head>
    <body>
        <h2>everiPay</h2>
        <p>Token: EVT</p>
        <blockquote><code></code></blockquote>
        <br>
        <div class="scanzone-wraper">
            <div style="background: #f5d7d7; border-top-left-radius: 8px; border-top-right-radius: 8px; padding: .6rem .9rem; color: black; font-size: 80%; border-top: 2px red solid;">
                The transaction will be <b>executed</b> instantly after scanned!
            </div>
            <image id="qr" style="display: block; box-sizing: border-box; padding: 1rem 3rem; width: 100%;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAegAAAHoCAYAAACCUHwMAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAe9SURBVHhe7dUxAQAgDMCwgX/PwIGIHslTCV3nGQAgZf8CACEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNAEEGDQBBBg0AQQYNADkzF8WlB8zy/kk+AAAAAElFTkSuQmCC"></image>
            <div style="text-align: center; background: #f5f5f5; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; padding: .6rem .9rem; color: black; font-size: 80%; border-top: 1px #f2f2f2 solid;">Will refresh automatically every 5s</div>
        </div>
        
        <pre style="text-align: center; max-width: 400px; color: rgb(210, 210, 210)">ONLY FOR USE FACE-TO-FACE
OR BEING SCANNED BY CORRECT SCANNERS
NEVER SHOW IT TO ANY OTHER PEOPLE</pre>
        <script>
            document.addEventListener("DOMContentLoaded", async function(event) {
                let linkId = await EVT.EvtLink.getUniqueLinkId();
                console.log("linkId: " + linkId);

                window.generateCode = async function run() {
                    try {
                        let time = new Date().valueOf();
                        EVT.EvtLink.getEVTLinkQrImage(
                            "everiPay",
                            {
                                keyProvider: "5JgWJptxZENHR69oZsPSeVTXScRx7jYPMTjPTKAjW2JFnjEhoDZ", // The private key to pay
                                symbol: 1, // EVT
                                maxAmount: 1000000, // Max charge (1 = 0.00001 EVT)
                                linkId
                            },
                            {
                                autoReload: true
                            },
                            (err, res) => {
                                if (err) {
                                    alert(err.message);
                                    return;
                                }
                                
                                document.getElementById("qr").setAttribute("src", res.dataUrl);
                                console.log(res.rawText);
                                EVT.EvtLink.parseEvtLink(res.rawText).then(res => {
                                    console.log(JSON.stringify(res, null, 2));
                                });
                        });
                    }
                    catch(e) {
                        alert(e.message);
                    }
                }

                window.checkPay = async function() {
                    let ret = await apiCaller.getStatusOfEvtLink({ linkId: linkId });
                    
                    if (!ret.pending && ret.transactionId) {
                        document.getElementById("fullpage-tip").style.display = "block";
                        linkId = await EVT.EvtLink.getUniqueLinkId();
                    }
                }

                setTimeout(() => window.generateCode(), 1);
                setTimeout(() => window.checkPay(), 100);
            });
        </script>

        <script src="../dist/evt.min.js" crossorigin="anonymous" defer></script>
    </body>
</html>
